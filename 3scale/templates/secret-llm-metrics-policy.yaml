{{ if .Values.apimanager.llmMetrics -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.apimanager.llmMetrics.name }}
  namespace: {{ .Values.namespace }}
  labels:
    apimanager.apps.3scale.net/watched-by: apimanager
data:
  apicast-policy.json: ewogICIkc2NoZW1hIjogImh0dHA6Ly9hcGljYXN0LmlvL3BvbGljeS12MS9zY2hlbWEjbWFuaWZlc3QjIiwKICAibmFtZSI6ICJMTE0gTW9uaXRvciIsCiAgInN1bW1hcnkiOiAiTW9uaXRvciBMTE0gdG9rZW4gdXNhZ2UiLAogICJkZXNjcmlwdGlvbiI6IFsKICAgICAgIkV4cG9zZSBwcm9tZXRoZXVzIG1ldHJpY3MgdG8gbW9uaXRvciBMTE0gdG9rZW4gdXNhZ2UiCiAgXSwKICAidmVyc2lvbiI6ICIwLjEiLAogICJjb25maWd1cmF0aW9uIjogewogICAgImRlZmluaXRpb25zIjogewogICAgICAib3BlcmF0aW9uIjogewogICAgICAgICJ0eXBlIjogIm9iamVjdCIsCiAgICAgICAgIiRpZCI6ICIjL2RlZmluaXRpb25zL29wZXJhdGlvbiIsCiAgICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgICAibGVmdCI6IHsKICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgfSwKICAgICAgICAgICJvcCI6IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIk9wZXJhdGlvbiB0byBhcHBseS4gVGhlIG1hdGNoZXMgb3Agc3VwcG9ydHMgUENSRSAoUGVybCBjb21wYXRpYmxlIHJlZ3VsYXIgZXhwcmVzc2lvbnMpIiwKICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICAgImVudW0iOiBbCiAgICAgICAgICAgICAgIj09IiwKICAgICAgICAgICAgICAiIT0iLAogICAgICAgICAgICAgICJtYXRjaGVzIgogICAgICAgICAgICBdCiAgICAgICAgICB9LAogICAgICAgICAgInJpZ2h0IjogewogICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciCiAgICAgICAgICB9LAogICAgICAgICAgImxlZnRfdHlwZSI6IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIkhvdyB0byBldmFsdWF0ZSAnbGVmdCciLAogICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAiZGVmYXVsdCI6ICJwbGFpbiIsCiAgICAgICAgICAgICJvbmVPZiI6IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiZW51bSI6IFsKICAgICAgICAgICAgICAgICAgInBsYWluIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJFdmFsdWF0ZSAnbGVmdCcgYXMgcGxhaW4gdGV4dC4iCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiZW51bSI6IFsKICAgICAgICAgICAgICAgICAgImxpcXVpZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiRXZhbHVhdGUgJ2xlZnQnIGFzIGxpcXVpZC4iCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9LAogICAgICAgICAgInJpZ2h0X3R5cGUiOiB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJIb3cgdG8gZXZhbHVhdGUgJ3JpZ2h0JyIsCiAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICJkZWZhdWx0IjogInBsYWluIiwKICAgICAgICAgICAgIm9uZU9mIjogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAicGxhaW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInRpdGxlIjogIkV2YWx1YXRlICdyaWdodCcgYXMgcGxhaW4gdGV4dC4iCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiZW51bSI6IFsKICAgICAgICAgICAgICAgICAgImxpcXVpZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidGl0bGUiOiAiRXZhbHVhdGUgJ3JpZ2h0JyBhcyBsaXF1aWQuIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgInJlcXVpcmVkIjogWwogICAgICAgICAgImxlZnQiLAogICAgICAgICAgIm9wIiwKICAgICAgICAgICJyaWdodCIKICAgICAgICBdCiAgICAgIH0sCiAgICAgICJjdXN0b21fbWV0cmljc19ydWxlIjogewogICAgICAgICJ0eXBlIjogIm9iamVjdCIsCiAgICAgICAgICJyZXF1aXJlZCI6IFsgIm1ldHJpYyIsICJjb25kaXRpb24iLCAiaW5jcmVtZW50IiBdLAogICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgIm1ldHJpYyI6IHsKICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICAgInRpdGxlIjogIk1ldHJpYyB0byBpbmNyZW1lbnQgIiwKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIk1ldHJpYyBuYW1lIHRvIGluY3JlbWVudCBpbiBjYXNlIG9mIGNvbmRpdGlvbiBtYXRjaCAobGlxdWlkIGlucHV0KSIsCiAgICAgICAgICAgICJkZWZhdWx0IjogIiIKICAgICAgICAgIH0sCiAgICAgICAgICAiaW5jcmVtZW50IjogewogICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAidGl0bGUiOiAiSW5jcmVtZW50ICIsCiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJIb3cgbWFueSBoaXRzIHNob3VsZCBiZSBpbmNyZW1lbnRlZCwgbGlxdWlkIHZhbHVlICIsCiAgICAgICAgICAgICJkZWZhdWx0IjogIjEiCiAgICAgICAgICB9LAogICAgICAgICAgImNvbmRpdGlvbiI6IHsKICAgICAgICAgICAgInR5cGUiOiAib2JqZWN0IiwKICAgICAgICAgICAgInRpdGxlIjogIkNvbmRpdGlvbiIsCiAgICAgICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICAgICAiY29tYmluZV9vcCIsCiAgICAgICAgICAgICAgIm9wZXJhdGlvbnMiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICJjb21iaW5lX29wIjogewogICAgICAgICAgICAgICAgInRpdGxlIjogIkNvbWJpbmUgb3BlcmF0aW9uIiwKICAgICAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICAgICAiZGVmYXVsdCI6ICJhbmQiLAogICAgICAgICAgICAgICAgImVudW0iOiBbCiAgICAgICAgICAgICAgICAgICJhbmQiLAogICAgICAgICAgICAgICAgICAib3IiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAib3BlcmF0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJ0eXBlIjogImFycmF5IiwKICAgICAgICAgICAgICAgICJpdGVtcyI6IHsKICAgICAgICAgICAgICAgICAgIiRyZWYiOiAiIy9kZWZpbml0aW9ucy9vcGVyYXRpb24iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm1pbkl0ZW1zIjogMQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJwcm9wZXJ0aWVzIjogewogICAgICAiZW5hYmxlX3NzZV9zdXBwb3J0IjogewogICAgICAgICJkZXNjcmlwdGlvbiI6ICJXaGV0aGVyIHRvIGVuYWJsZSBzdXBwb3J0IGZvciBTZXJ2ZXItU2VudCBFdmVudHMoU1NFKSIsCiAgICAgICAgInR5cGUiOiAiYm9vbGVhbiIKICAgICAgfSwKICAgICAgInJ1bGVzIjogewogICAgICAgICJ0eXBlIjogImFycmF5IiwKICAgICAgICAiaXRlbXMiOiB7CiAgICAgICAgICAgICIkcmVmIjogIiMvZGVmaW5pdGlvbnMvY3VzdG9tX21ldHJpY3NfcnVsZSIKICAgICAgICAgfSwKICAgICAgICAibWluSXRlbXMiOiAxCiAgICAgIH0KICAgIH0KICB9Cn0K
  custom_metrics.lua: bG9jYWwgdGluc2VydCA9IHRhYmxlLmluc2VydAoKbG9jYWwgaHR0cF9uZ19yZXN0eSA9IHJlcXVpcmUgKCdyZXN0eS5odHRwX25nLmJhY2tlbmQucmVzdHknKQpsb2NhbCBSZXBvcnRzQmF0Y2ggPSByZXF1aXJlKCdhcGljYXN0LnBvbGljeS4zc2NhbGVfYmF0Y2hlci5yZXBvcnRzX2JhdGNoJykKbG9jYWwgYmFja2VuZF9jbGllbnQgPSByZXF1aXJlKCdhcGljYXN0LmJhY2tlbmRfY2xpZW50JykKCmxvY2FsIF9NID0ge30KCi0tIHJlcG9ydDogUmVwb3J0IHRoZSBnaXZlbiB1c2FnZSBpbmZvcm1hdGlvbiB0byB0aGUgYmFja2VuZApmdW5jdGlvbiBfTS5yZXBvcnQoY29udGV4dCwgdXNhZ2UpCiAgbG9jYWwgYmFja2VuZCA9IGJhY2tlbmRfY2xpZW50Om5ldyhjb250ZXh0LnNlcnZpY2UsIGh0dHBfbmdfcmVzdHkpCiAgbG9jYWwgcmVwb3J0cyA9IHt9CiAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnModXNhZ2UuZGVsdGFzKSBkbwogICAgbG9jYWwgcmVzdWx0ID0gZGVlcGNvcHkoY29udGV4dC5jcmVkZW50aWFscykKICAgIHJlc3VsdC5tZXRyaWMgPSBrZXkKICAgIHJlc3VsdC52YWx1ZSA9IHZhbHVlCiAgICByZXN1bHQuc2VydmljZV9pZCA9IGNvbnRleHQuc2VydmljZS5pZAogICAgdGluc2VydChyZXBvcnRzLCByZXN1bHQpCiAgZW5kCgogIGxvY2FsIHJlcyA9IGJhY2tlbmQ6cmVwb3J0KFJlcG9ydHNCYXRjaC5uZXcoY29udGV4dC5zZXJ2aWNlLmlkLCByZXBvcnRzKSkKICBpZiByZXMuc3RhdHVzIH49IDIwMCB0aGVuCiAgICBuZ3gubG9nKG5neC5JTkZPLCAiQ3VzdG9tIG1ldHJpYyByZXBvcnQgdXNhZ2UgZmFpbGVkIikKICBlbmQKZW5kCgpyZXR1cm4gX00K
  init.lua: cmV0dXJuIHJlcXVpcmUoJ2xsbScpCg==
  llm.lua: bG9jYWwgbGVuID0gc3RyaW5nLmxlbgpsb2NhbCBpcGFpcnMgPSBpcGFpcnMKbG9jYWwgcGFpcnMgPSBwYWlycwpsb2NhbCB0aW5zZXJ0ID0gdGFibGUuaW5zZXJ0Cgpsb2NhbCBwb2xpY3kgPSByZXF1aXJlKCdhcGljYXN0LnBvbGljeScpCmxvY2FsIHByb21ldGhldXMgPSByZXF1aXJlKCdhcGljYXN0LnByb21ldGhldXMnKQpsb2NhbCBDb25kaXRpb24gPSByZXF1aXJlKCdhcGljYXN0LmNvbmRpdGlvbnMuY29uZGl0aW9uJykKbG9jYWwgTGlua2VkTGlzdCA9IHJlcXVpcmUoJ2FwaWNhc3QubGlua2VkX2xpc3QnKQpsb2NhbCBUZW1wbGF0ZVN0cmluZyA9IHJlcXVpcmUoJ2FwaWNhc3QudGVtcGxhdGVfc3RyaW5nJykKbG9jYWwgT3BlcmF0aW9uID0gcmVxdWlyZSgnYXBpY2FzdC5jb25kaXRpb25zLm9wZXJhdGlvbicpCmxvY2FsIFVzYWdlID0gcmVxdWlyZSgnYXBpY2FzdC51c2FnZScpCmxvY2FsIHJlc3R5X2VudiA9IHJlcXVpcmUgKCdyZXN0eS5lbnYnKQpsb2NhbCByZXN0eV91cmwgPSByZXF1aXJlICdyZXN0eS51cmwnCmxvY2FsIGNqc29uID0gcmVxdWlyZSAnY2pzb24uc2FmZScKCmxvY2FsIHJlc3BvbnNlID0gcmVxdWlyZSAoJ3Jlc3BvbnNlJykKbG9jYWwgcG9ydGFsX2NsaWVudCA9IHJlcXVpcmUoJ3BvcnRhbF9jbGllbnQnKQpsb2NhbCBjdXN0b21fbWV0cmljcyA9IHJlcXVpcmUoJ2N1c3RvbV9tZXRyaWNzJykKCmxvY2FsIGRlZmF1bHRfY29tYmluZV9vcCA9ICJhbmQiCmxvY2FsIGRlZmF1bHRfdGVtcGxhdGVfdHlwZSA9ICJwbGFpbiIKbG9jYWwgbGlxdWlkX3RlbXBsYXRlX3R5cGUgPSAibGlxdWlkIgoKbG9jYWwgX00gPSBwb2xpY3kubmV3KCdMTE0gbWV0cmljcycsICdidWlsdGluJykKCmxvY2FsIG5ldyA9IF9NLm5ldwoKLS0gUmVnaXN0ZXIgbWV0cmljcwpsb2NhbCBsbG1fcHJvbXB0X3Rva2Vuc19jb3VudCA9IHByb21ldGhldXMoCiAgJ2NvdW50ZXInLAogICdsbG1fcHJvbXB0X3Rva2Vuc19jb3VudCcsCiAgJ1Rva2VuIGNvdW50IGZvciBhIHByb21wdCcsCiAgeydzZXJ2aWNlX2lkJywgJ3NlcnZpY2Vfc3lzdGVtX25hbWUnLCAnYXBwbGljYXRpb25faWQnLCAnYXBwbGljYXRpb25fc3lzdGVtX25hbWUnfQopCgpsb2NhbCBsbG1fY29tcGxldGlvbl90b2tlbnNfY291bnQgPSBwcm9tZXRoZXVzKAogICdjb3VudGVyJywKICAnbGxtX2NvbXBsZXRpb25fdG9rZW5zX2NvdW50JywKICAiVG9rZW4gY291bnQgZm9yIGEgY29tcGxldGlvbiIsCiAgeydzZXJ2aWNlX2lkJywgJ3NlcnZpY2Vfc3lzdGVtX25hbWUnLCAnYXBwbGljYXRpb25faWQnLCAnYXBwbGljYXRpb25fc3lzdGVtX25hbWUnfQopCgpsb2NhbCBsbG1fdG90YWxfdG9rZW5fY291bnQgPSBwcm9tZXRoZXVzKAogICdjb3VudGVyJywKICAnbGxtX3RvdGFsX3Rva2VuX2NvdW50JywKICAiVG90YWwgdG9rZW4gY291bnQiLAogIHsnc2VydmljZV9pZCcsICdzZXJ2aWNlX3N5c3RlbV9uYW1lJywgJ2FwcGxpY2F0aW9uX2lkJywgJ2FwcGxpY2F0aW9uX3N5c3RlbV9uYW1lJ30KKQoKbG9jYWwgZnVuY3Rpb24gZ2V0X2NvbnRleHQoY29udGV4dCkKICBsb2NhbCBjdHggPSB7IH0KICBjdHgucmVxID0gewogICAgaGVhZGVycz1uZ3gucmVxLmdldF9oZWFkZXJzKCksCiAgfQoKICBjdHgucmVzcCA9IHsKICAgIGhlYWRlcnM9bmd4LnJlc3AuZ2V0X2hlYWRlcnMoKSwKICB9CgogIGN0eC51c2FnZSA9IGNvbnRleHQudXNhZ2UKICBjdHguc2VydmljZSA9IGNvbnRleHQuc2VydmljZSBvciB7fQogIGN0eC5vcmlnaW5hbF9yZXF1ZXN0ID0gY29udGV4dC5vcmlnaW5hbF9yZXF1ZXN0CiAgY3R4Lmp3dCA9IGNvbnRleHQuand0IG9yIHt9CiAgY3R4LmFwcGxpY2F0aW9uID0gY29udGV4dC5hcHBsaWNhdGlvbiBvciB7fQogIGN0eC5sbG1fdXNhZ2UgPSBjb250ZXh0LmxsbV91c2FnZSBvciB7fQogIHJldHVybiBMaW5rZWRMaXN0LnJlYWRvbmx5KGN0eCwgbmd4LnZhcikKZW5kCgpsb2NhbCBmdW5jdGlvbiBsb2FkX2NvbmRpdGlvbihjb25kaXRpb25fY29uZmlnKQogIGlmIG5vdCBjb25kaXRpb25fY29uZmlnIHRoZW4KICAgIHJldHVybiBuaWwKICBlbmQKICBsb2NhbCBvcGVyYXRpb25zID0ge30KICBmb3IgXywgb3BlcmF0aW9uIGluIGlwYWlycyhjb25kaXRpb25fY29uZmlnLm9wZXJhdGlvbnMgb3Ige30pIGRvCiAgICB0aW5zZXJ0KCBvcGVyYXRpb25zLAogICAgICBPcGVyYXRpb24ubmV3KAogICAgICAgIG9wZXJhdGlvbi5sZWZ0LAogICAgICAgIG9wZXJhdGlvbi5sZWZ0X3R5cGUgb3IgZGVmYXVsdF90ZW1wbGF0ZV90eXBlLAogICAgICAgIG9wZXJhdGlvbi5vcCwKICAgICAgICBvcGVyYXRpb24ucmlnaHQsCiAgICAgICAgb3BlcmF0aW9uLnJpZ2h0X3R5cGUgb3IgZGVmYXVsdF90ZW1wbGF0ZV90eXBlKSkKICBlbmQKCiAgcmV0dXJuIENvbmRpdGlvbi5uZXcoCiAgICBvcGVyYXRpb25zLAogICAgY29uZGl0aW9uX2NvbmZpZy5jb21iaW5lX29wIG9yIGRlZmF1bHRfY29tYmluZV9vcCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBsb2FkX3J1bGVzKHNlbGYsIGNvbmZpZ19ydWxlcykKICBpZiBub3QgY29uZmlnX3J1bGVzIHRoZW4KICAgIHJldHVybgogIGVuZAogIGxvY2FsIHJ1bGVzID0ge30KICBmb3IgXyxydWxlIGluIHBhaXJzKGNvbmZpZ19ydWxlcykgZG8KICAgICAgdGluc2VydChydWxlcywgewogICAgICAgIGNvbmRpdGlvbiA9IGxvYWRfY29uZGl0aW9uKHJ1bGUuY29uZGl0aW9uKSwKICAgICAgICBtZXRyaWMgPSBUZW1wbGF0ZVN0cmluZy5uZXcocnVsZS5tZXRyaWMgb3IgIiIsIGxpcXVpZF90ZW1wbGF0ZV90eXBlKSwKICAgICAgICBpbmNyZW1lbnQgPSBUZW1wbGF0ZVN0cmluZy5uZXcocnVsZS5pbmNyZW1lbnQgb3IgIjAiLCBsaXF1aWRfdGVtcGxhdGVfdHlwZSkKICAgICAgfSkKICBlbmQKICBzZWxmLnJ1bGVzID0gcnVsZXMKZW5kCgotLS0gSW5pdGlhbGl6ZSBsbG0gcG9saWN5Ci0tIEB0cGFyYW1bb3B0XSB0YWJsZSBjb25maWcgUG9saWN5IGNvbmZpZ3VyYXRpb24uCmZ1bmN0aW9uIF9NLm5ldyhjb25maWcpCiAgbG9jYWwgc2VsZiA9IG5ldyhjb25maWcpCiAgc2VsZi5lbmRwb2ludCA9IHJlc3R5X2Vudi5nZXQoJ1RIUkVFU0NBTEVfUE9SVEFMX0VORFBPSU5UJykKICBsb2NhbCBwYXRoID0gcmVzdHlfdXJsLnNwbGl0KHNlbGYuZW5kcG9pbnQgb3IgJycpCiAgc2VsZi5wYXRoID0gcGF0aCBhbmQgcGF0aFs2XQogIHNlbGYucnVsZXMgPSB7fQogIHNlbGYuZW5hYmxlX3NzZV9zdXBwb3J0ID0gY29uZmlnLmVuYWJsZV9zc2Vfc3VwcG9ydAogIGxvYWRfcnVsZXMoc2VsZiwgY29uZmlnLnJ1bGVzIG9yIHt9KQogIHJldHVybiBzZWxmCmVuZAoKLS0gUmV3cml0ZSByZXF1ZXN0IHRvIG1ha2Ugc3VyZSB0b2tlbiB1c2FnZSBpcyBpbmNsdWRlZCBpbiB0aGUgcmVzcG9uc2UKZnVuY3Rpb24gX00ucmV3cml0ZShjb250ZXh0KQogIG5neC5yZXEucmVhZF9ib2R5KCkKICBsb2NhbCByZXFfYm9keSA9IG5neC5yZXEuZ2V0X2JvZHlfZGF0YSgpCiAgaWYgbm90IHJlcV9ib2R5IHRoZW4KICAgIHJldHVybgogIGVuZAoKICBsb2NhbCBzdWNjZXNzLCBwYXlsb2FkID0gcGNhbGwoY2pzb24uZGVjb2RlLCByZXFfYm9keSkKICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICBuZ3gubG9nKG5neC5FUlIsICJGYWlsZWQgdG8gZGVjb2RlIEpTT04gcGF5bG9hZCIpCiAgICByZXR1cm4KICBlbmQKCiAgLS0gQ2hlY2sgYW5kIG1vZGlmeSB0aGUgcGF5bG9hZAogIGlmIHBheWxvYWQuc3RyZWFtID09IHRydWUgdGhlbgogICAgLS0gRW5zdXJlICJzdHJlYW1fb3B0aW9ucyIgZXhpc3RzCiAgICBpZiBub3QgcGF5bG9hZC5zdHJlYW1fb3B0aW9ucyB0aGVuCiAgICAgIHBheWxvYWQuc3RyZWFtX29wdGlvbnMgPSB7CiAgICAgICAgaW5jbHVkZV91c2FnZSA9IHRydWUsCiAgICAgICAgY29udGludW91c191c2FnZV9zdGF0cyA9IHRydWUKICAgICAgfQogICAgZW5kCgogICAgLS0gTW9kaWZ5ICJpbmNsdWRlX3VzYWdlIiB0byB0cnVlIGlmIGl0J3MgZmFsc2UKICAgIGlmIHBheWxvYWQuc3RyZWFtX29wdGlvbnMuaW5jbHVkZV91c2FnZSA9PSBmYWxzZSB0aGVuCiAgICAgIHBheWxvYWQuc3RyZWFtX29wdGlvbnMuaW5jbHVkZV91c2FnZSA9IHRydWUKICAgIGVuZAogIGVuZAoKICAtLSBFbmNvZGUgdGhlIG1vZGlmaWVkIHBheWxvYWQgYmFjayB0byBKU09OCiAgbG9jYWwgbW9kaWZpZWRfYm9keSA9IGNqc29uLmVuY29kZShwYXlsb2FkKQogIG5neC5yZXEuY2xlYXJfaGVhZGVyKCJDb250ZW50LUxlbmd0aCIpCiAgbmd4LnJlcS5zZXRfYm9keV9kYXRhKG1vZGlmaWVkX2JvZHkpCiAgbmd4LnJlcS5zZXRfaGVhZGVyKCJDb250ZW50LUxlbmd0aCIsICNtb2RpZmllZF9ib2R5KQplbmQKCi0tIE5lZWQgdG8gZmV0Y2ggYXBwbGljYXRpb24gaGVyZSBhcyBjb3NvY2tldCBpcyBkaXNhYmxlZAotLSBpbiBib2R5X2ZpbHRlciBwaGFzZQpmdW5jdGlvbiBfTTphY2Nlc3MoY29udGV4dCkKICBpZiBzZWxmLnBhdGggdGhlbgogICAgY29udGV4dC5hcHBsaWNhdGlvbiA9IHsgaWQgPSAiIiwgbmFtZSA9ICIiIH0KICBlbHNlCiAgICBsb2NhbCBzZXJ2aWNlID0gY29udGV4dC5zZXJ2aWNlCiAgICBpZiBub3Qgc2VydmljZSB0aGVuCiAgICAgIG5neC5sb2cobmd4LkVSUiwgJ05vIHNlcnZpY2UgaW4gdGhlIGNvbnRleHQnKQogICAgICByZXR1cm4KICAgIGVuZAoKICAgIGxvY2FsIGNyZWRlbnRpYWxzID0gY29udGV4dC5jcmVkZW50aWFscwogICAgaWYgbm90IGNyZWRlbnRpYWxzIHRoZW4KICAgICAgbmd4LmxvZyhuZ3guV0FSTiwgImNhbm5vdCBnZXQgY3JlZGVudGlhbHM6ICIsIGVyciBvciAndW5rbm93biBlcnJvcicpCiAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgYXBwbGljYXRpb24sIGVyciA9IHBvcnRhbF9jbGllbnQuZmluZF9hcHBsaWNhdGlvbihzZWxmLmVuZHBvaW50LCBzZXJ2aWNlLmlkLCBjcmVkZW50aWFscykKICAgIGlmIG5vdCBhcHBsaWNhdGlvbiB0aGVuCiAgICAgIG5neC5sb2cobmd4LldBUk4sICJjYW5ub3QgZ2V0IGFwcGxpY2F0aW9uIGRldGFpbHM6ICIsIGVyciBvciAndW5rbm93biBlcnJvcicpCiAgICAgIHJldHVybgogICAgZW5kCgogICAgY29udGV4dC5hcHBsaWNhdGlvbiA9IGFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uCiAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gcmVwb3J0X21ldHJpY3MoY29udGV4dCkKICAgIGxvY2FsIHNlcnZpY2UgPSBjb250ZXh0LnNlcnZpY2UKICAgIGlmIG5vdCBzZXJ2aWNlIHRoZW4KICAgICAgIG5neC5sb2cobmd4LkVSUiwgJ05vIHNlcnZpY2UgaW4gdGhlIGNvbnRleHQnKQogICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBsb2NhbCBhcHBsaWNhdGlvbiA9IGNvbnRleHQuYXBwbGljYXRpb24KICAgIGxvY2FsIHVzYWdlID0gY29udGV4dC5sbG1fdXNhZ2UKCiAgICBpZiB1c2FnZSBhbmQgdXNhZ2UucHJvbXB0X3Rva2VucyBhbmQgdXNhZ2UucHJvbXB0X3Rva2VucyA+IDAgdGhlbgogICAgICBsbG1fcHJvbXB0X3Rva2Vuc19jb3VudDppbmModXNhZ2UucHJvbXB0X3Rva2VucywgewogICAgICAgIHNlcnZpY2UuaWQgb3IgIiIsCiAgICAgICAgc2VydmljZS5zeXN0ZW1fbmFtZSBvciAiIiwKICAgICAgICBhcHBsaWNhdGlvbi5pZCBvciAiIiwKICAgICAgICBhcHBsaWNhdGlvbi5uYW1lIG9yICIiCiAgICAgIH0pCiAgICBlbmQKCiAgICBpZiB1c2FnZSBhbmQgdXNhZ2UuY29tcGxldGlvbl90b2tlbnMgYW5kIHVzYWdlLmNvbXBsZXRpb25fdG9rZW5zID4gMCB0aGVuCiAgICAgIGxsbV9jb21wbGV0aW9uX3Rva2Vuc19jb3VudDppbmModXNhZ2UuY29tcGxldGlvbl90b2tlbnMsIHsKICAgICAgICBzZXJ2aWNlLmlkIG9yICIiLAogICAgICAgIHNlcnZpY2Uuc3lzdGVtX25hbWUgb3IgIiIsCiAgICAgICAgYXBwbGljYXRpb24uaWQgb3IgIiIsCiAgICAgICAgYXBwbGljYXRpb24ubmFtZSBvciAiIgogICAgICB9KQogICAgZW5kCgogICAgaWYgdXNhZ2UgYW5kIHVzYWdlLnRvdGFsX3Rva2VucyBhbmQgdXNhZ2UudG90YWxfdG9rZW5zID4gMCB0aGVuCiAgICAgIGxsbV90b3RhbF90b2tlbl9jb3VudDppbmModXNhZ2UudG90YWxfdG9rZW5zLCB7CiAgICAgICAgc2VydmljZS5pZCBvciAiIiwKICAgICAgICBzZXJ2aWNlLnN5c3RlbV9uYW1lIG9yICIiLAogICAgICAgIGFwcGxpY2F0aW9uLmlkIG9yICIiLAogICAgICAgIGFwcGxpY2F0aW9uLm5hbWUgb3IgIiIKICAgICAgfSkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIF9NOmJvZHlfZmlsdGVyKGNvbnRleHQpCiAgbG9jYWwgY29udGVudF90eXBlID0gbmd4LnJlc3AuZ2V0X2hlYWRlcnMoKVsiQ29udGVudC1UeXBlIl0KICBsb2NhbCBjaHVuaywgZmluaXNoZWQgPSBuZ3guYXJnWzFdLCBuZ3guYXJnWzJdCgogIGlmIHNlbGYuZW5hYmxlX3NzZV9zdXBwb3J0IGFuZCByZXNwb25zZS5pc1NTRVN0cmVhbWluZ1Jlc3BvbnNlKGNvbnRlbnRfdHlwZSkgdGhlbgogICAgaWYgZmluaXNoZWQgdGhlbgogICAgICByZXR1cm4gcmVwb3J0X21ldHJpY3MoY29udGV4dCkKICAgIGVuZAoKICAgIGxvY2FsIGV2ZW50cyA9IHJlc3BvbnNlLmdldF9zc2VfZXZlbnRzKGNodW5rKQoKICAgIC0tIC0tIG5vIGV2ZW50cywgY29udGludWUKICAgIGlmIG5vdCBldmVudHMgdGhlbgogICAgICByZXR1cm4KICAgIGVuZAoKICAgIGZvciBfLCBldmVudCBpbiBpcGFpcnMoZXZlbnRzKSBkbwogICAgICBpZiBldmVudC5kYXRhIH49IHJlc3BvbnNlLkNPTlNULlNTRV9URVJNSU5BVE9SIHRoZW4KICAgICAgICBsb2NhbCBqc29uLCBlcnIgPSBjanNvbi5kZWNvZGUoZXZlbnQuZGF0YSkKICAgICAgICBpZiBlcnIgdGhlbgogICAgICAgICAgLS0gU2lsZW5jaW5nIHRoaXMgZm9yIHRoZSBtb21lbnQKICAgICAgICAgIC0tIG5neC5sb2cobmd4LkVSUiwgInVuYWJsZSB0byByZWFkIHJlc3BvbnNlX2JvZHksIGVycjogIiAuLiBlcnIpCiAgICAgICAgICBuZ3guZXhpdCg1MDApCiAgICAgICAgZW5kCgogICAgICAgIC0tIFNvbWUgbW9kZWwgaW5jbHVkZSB1c2FnZSBmaWVsZCBpbiBlYWNoIGV2ZW50LCB3ZSBvbmx5IHdhbnQgdG8KICAgICAgICAtLSB0YWtlIHRoZSBsYXN0IG9uZS4KICAgICAgICBsb2NhbCB1c2FnZSA9IGpzb24udXNhZ2UKICAgICAgICBpZiB1c2FnZSB0aGVuCiAgICAgICAgICBjb250ZXh0LmxsbV91c2FnZSA9IHVzYWdlCiAgICAgICAgZW5kCiAgICAgIGVuZAogICAgZW5kCiAgZWxzZQogICAgbG9jYWwgcmVzcG9uc2VfYm9keSwgZXJyID0gcmVzcG9uc2UuZ2V0X2pzb25fYm9keShjaHVuaywgZmluaXNoZWQpCiAgICBpZiBlcnIgdGhlbgogICAgICBuZ3gubG9nKG5neC5FUlIsICJ1bmFibGUgdG8gcmVhZCByZXNwb25zZV9ib2R5LCBlcnI6ICIgLi4gZXJyKQogICAgICBuZ3guZXhpdCg1MDApCiAgICBlbmQKICAgIGlmIHJlc3BvbnNlX2JvZHkgdGhlbgogICAgICBsb2NhbCB1c2FnZSA9IHJlc3BvbnNlX2JvZHkudXNhZ2UKICAgICAgbG9jYWwgaW5zcGVjdCA9IHJlcXVpcmUgJ2luc3BlY3QnCgogICAgICBjb250ZXh0LmxsbV91c2FnZSA9IHVzYWdlCiAgICAgIHJldHVybiByZXBvcnRfbWV0cmljcyhjb250ZXh0KQogICAgZW5kCiAgZW5kCmVuZAoKZnVuY3Rpb24gX006cG9zdF9hY3Rpb24oY29udGV4dCkKICAtLSBjb250ZXh0IHdpdGggYWxsIHZhcmlhYmxlcyBhcmUgbmVlZGVkIHRvIHJldHJpZXZlIGluZm9ybWF0aW9uIGFib3V0IEFQSQogIC0tIHJlc3BvbnNlCiAgbG9jYWwgY3R4ID0gZ2V0X2NvbnRleHQoY29udGV4dCkKCiAgLS0gV2UgaW5pdGlhbGl6ZSB0aGUgdXNhZ2UsIGFuZCBpZiBhbnkgcnVsZSBtYXRjaCwgd2UgcmVwb3J0IHRoZSB1c2FnZSB0bwogIC0tIGJhY2tlbmQuCiAgbG9jYWwgbWF0Y2ggPSBmYWxzZQogIGxvY2FsIHVzYWdlID0gVXNhZ2UubmV3KCkKCiAgZm9yIF8sIHJ1bGUgaW4gaXBhaXJzKHNlbGYucnVsZXMpIGRvCiAgICBpZiBydWxlLmNvbmRpdGlvbjpldmFsdWF0ZShjdHgpIHRoZW4KICAgICAgbG9jYWwgbWV0cmljID0gcnVsZS5tZXRyaWM6cmVuZGVyKGN0eCkKICAgICAgaWYgbGVuKG1ldHJpYykgPiAwIHRoZW4KICAgICAgICB1c2FnZTphZGQobWV0cmljLCB0b251bWJlcihydWxlLmluY3JlbWVudDpyZW5kZXIoY3R4KSkgb3IgMCkKICAgICAgICBtYXRjaCA9IHRydWUKICAgICAgZW5kCiAgICBlbmQKICBlbmQKCiAgaWYgbm90IG1hdGNoIHRoZW4KICAgIHJldHVybgogIGVuZAoKICAtLSBJZiBjYWNoZWQga2V5IGF1dGhyZXAgY2FsbCB3aWxsIGhhcHBlbiBvbiBBUElDYXN0IHBvbGljeSwgc28gbm8gbmVlZCB0bwogIC0tIHJlcG9ydCBvbmx5IG9uZSBtZXRyaWMuIElmIG5vIGNhY2hlZCBrZXkgd2lsbCByZXBvcnQgb25seSB0aGUgbmV3IG1ldHJpY3MuCiAgaWYgbmd4LnZhci5jYWNoZWRfa2V5IHRoZW4KICAgIGNvbnRleHQudXNhZ2U6bWVyZ2UodXNhZ2UpCiAgICByZXR1cm4KICBlbmQKICBjdXN0b21fbWV0cmljcy5yZXBvcnQoY29udGV4dCwgdXNhZ2UpCmVuZAoKcmV0dXJuIF9NCg==
  portal_client.lua: bG9jYWwgY29uY2F0ID0gdGFibGUuY29uY2F0CmxvY2FsIGluc2VydCA9IHRhYmxlLmluc2VydApsb2NhbCBsZW4gPSBzdHJpbmcubGVuCgpsb2NhbCB1c2VyX2FnZW50ID0gcmVxdWlyZSgnYXBpY2FzdC51c2VyX2FnZW50JykKbG9jYWwgcmVzdHlfdXJsID0gcmVxdWlyZSAoJ3Jlc3R5LnVybCcpCmxvY2FsIGh0dHBfbmcgPSByZXF1aXJlICgncmVzdHkuaHR0cF9uZycpCmxvY2FsIGh0dHBfbmdfcmVzdHkgPSByZXF1aXJlICgncmVzdHkuaHR0cF9uZy5iYWNrZW5kLnJlc3R5JykKbG9jYWwgcmVzdHlfZW52ID0gcmVxdWlyZSAoJ3Jlc3R5LmVudicpCmxvY2FsIHJlc3BvbnNlID0gcmVxdWlyZSAoJ3Jlc3BvbnNlJykKCmxvY2FsIF9NID0ge30KCmxvY2FsIGZ1bmN0aW9uIGJ1aWxkX2FyZ3MoYXJncykKICBsb2NhbCBxdWVyeSA9IHt9CgogIGZvciBpPTEsICNhcmdzIGRvCiAgICBsb2NhbCBhcmcgPSBuZ3guZW5jb2RlX2FyZ3MoYXJnc1tpXSkKICAgIGlmIGxlbihhcmcpID4gMCB0aGVuCiAgICAgIGluc2VydChxdWVyeSwgYXJnKQogICAgZW5kCiAgZW5kCgogIHJldHVybiBjb25jYXQocXVlcnksICcmJykKZW5kCgpsb2NhbCBmdW5jdGlvbiBhcHBsaWNhdGlvbl9maW5kX2VuZHBvaW50KHBvcnRhbF9lbmRwb2ludCkKICByZXR1cm4gcmVzdHlfdXJsLmpvaW4ocG9ydGFsX2VuZHBvaW50LCAnL2FkbWluL2FwaS9hcHBsaWNhdGlvbnMvZmluZC5qc29uJykKZW5kCgotLSBDYWxsIC9hZG1pbi9hcGkvYXBwbGljYXRpb25zL2ZpbmQuanNvbgpmdW5jdGlvbiBfTS5maW5kX2FwcGxpY2F0aW9uKGVuZHBvaW50LCBzZXJ2aWNlX2lkLCBjcmVkZW50aWFscykKICBpZiBub3QgZW5kcG9pbnQgdGhlbgogICAgcmV0dXJuIG5pbCwgIk5vIGVuZHBvaW50IGF2YWlsYWJsZSIKICBlbmQKCiAgbG9jYWwgYmFzZV91cmwgPSBhcHBsaWNhdGlvbl9maW5kX2VuZHBvaW50KGVuZHBvaW50KQogIGxvY2FsIGF1dGhlbnRpY2F0aW9uID0geyBzZXJ2aWNlX2lkID0gc2VydmljZV9pZCB9CiAgbG9jYWwgYXJncyA9IHthdXRoZW50aWNhdGlvbiwgY3JlZGVudGlhbHN9CgogIGxvY2FsIHVybCA9IGJhc2VfdXJsLi4iPyIuLiBidWlsZF9hcmdzKGFyZ3MpCgogIG5neC5sb2cobmd4LkRFQlVHLCAnZmV0Y2hpbmcgYXBwbGljYXRpb24gZGV0YWlscyBhdCAnLCB1cmwpCgogIGxvY2FsIGh0dHBfY2xpZW50ID0gaHR0cF9uZy5uZXd7CiAgICBiYWNrZW5kID0gaHR0cF9uZ19yZXN0eSwKICAgIG9wdGlvbnMgPSB7CiAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgWydVc2VyLUFnZW50J10gPSB1c2VyX2FnZW50KCkKICAgICAgfSwKICAgICAgc3NsID0geyB2ZXJpZnkgPSByZXN0eV9lbnYuZW5hYmxlZCgnT1BFTlNTTF9WRVJJRlknKSB9CiAgICB9CiAgfQoKICBsb2NhbCByZXMgPSBodHRwX2NsaWVudC5nZXQodXJsKQoKICBpZiByZXMuc3RhdHVzID09IDIwMCB0aGVuCiAgICBsb2NhbCB2YWwsIGVyciA9IHJlc3BvbnNlLmRlY29kZV9qc29uKHJlcykKICAgICAgaWYgZXJyIHRoZW4KICAgICAgbmd4LmxvZyhuZ3guRVJSLCAnaW52YWxpZCBhcHBsaWNhdGlvbiByZXNwb25zZSwgY2Fubm90IGRlY29kZSB0aGUgbWVzc2FnZTogJywgcmVzLmhlYWRlcnMuY29udGVudF90eXBlLCAnLCBlcnJvcjonLCBlcnIgLCcsIGJvZHk6ICcsIHJlcy5ib2R5KQogICAgICByZXR1cm4gbmlsLCAiQ2Fubm90IGRlY29kZSBhcHBsaWNhdGlvbiByZXF1ZXN0IHJlc3BvbnNlIgogICAgZW5kCiAgICByZXR1cm4gdmFsCiAgZWxzZQogICAgcmV0dXJuIG5pbCwgJ2ludmFsaWQgcmVzcG9uc2UgLSBzdGF0dXM6ICcgLi4gcmVzLnN0YXR1cwogIGVuZAplbmQKCgpyZXR1cm4gX00K
  response.lua: bG9jYWwgY2pzb24gPSByZXF1aXJlICdjanNvbi5zYWZlJwpsb2NhbCBNaW1lID0gcmVxdWlyZSAncmVzdHkubWltZScKCmxvY2FsIHN0cl9maW5kID0gc3RyaW5nLmZpbmQKbG9jYWwgc3RyX3N1YiA9IHN0cmluZy5zdWIKbG9jYWwgY29uY2F0ID0gdGFibGUuY29uY2F0CmxvY2FsIHNwbGl0ID0gcmVxdWlyZSAncGwuc3RyaW5neCcuc3BsaXQKCmxvY2FsIGFyZyA9IG5neC5hcmcKCmxvY2FsIGpzb25fY29udGVudF90eXBlcyA9IHsKICBbImFwcGxpY2F0aW9uL2pzb24iXSA9IHRydWUsCn0KCmxvY2FsIHNzZV9jb250ZW50X3R5cGVzID0gewogIFsidGV4dC9ldmVudC1zdHJlYW0iXSA9IHRydWUsCn0KCmxvY2FsIF9NID0ge30KCl9NLkNPTlNUID0gewogIFsiU1NFX1RFUk1JTkFUT1IiXSA9ICJbRE9ORV0iLAp9CgotLSBCdWZmZXJpbmcgdGhlIHJlc3BvbnNlIGJvZHkgaW4gdGhlIGludGVybmFsIHJlcXVlc3QgY29udGV4dAotLSBhbmQgcmV0dXJuIHRoZSBmdWxsIGJvZHkgd2hlbiBsYXN0IGNodW5rIGhhcyBiZWVuIHJlYWQKZnVuY3Rpb24gX00uZ2V0X3Jhd19ib2R5KGNodW5rLCBmaW5pc2hlZCkKICBsb2NhbCBidWZmZXJlZCA9IG5neC5jdHguYnVmZmVyZWRfcmVzcG9uc2VfYm9keQoKICAtLSBTaW5nbGUgY2h1bmsKICBpZiBmaW5pc2hlZCBhbmQgbm90IGJ1ZmZlcmVkIHRoZW4KICAgIHJldHVybiBjaHVuawogIGVuZAoKICBpZiB0eXBlKGNodW5rKSA9PSAic3RyaW5nIiBhbmQgY2h1bmsgfj0gIiIgdGhlbgogICAgaWYgbm90IGJ1ZmZlcmVkIHRoZW4KICAgICAgYnVmZmVyZWQgPSB7fSAtLSBYWFggd2UgY2FuIHVzZSB0YWJsZS5uZXcgaGVyZQogICAgICBuZ3guY3R4LmJ1ZmZlcmVkX3Jlc3BvbnNlX2JvZHkgPSBidWZmZXJlZAogICAgZW5kCgogICAgYnVmZmVyZWRbI2J1ZmZlcmVkKzFdID0gY2h1bmsKICAgIG5neC5hcmdbMV0gPSBuaWwKICBlbmQKCiAgLS0gRW5kIG9mIGNodW5rCiAgaWYgZmluaXNoZWQgdGhlbgogICAgaWYgYnVmZmVyZWQgdGhlbgogICAgICBidWZmZXJlZCA9IGNvbmNhdChidWZmZXJlZCkKICAgIGVsc2UKICAgICAgYnVmZmVyZWQgPSAiIgogICAgZW5kCgogICAgLS0gU2VuZCByZXNwb25zZSBhbmQgY2xlYXIgdGhlIGJ1ZmZlcmVkIGJvZHkKICAgIGFyZ1sxXSA9IGJ1ZmZlcmVkCiAgICBuZ3guY3R4LmJ1ZmZlcmVkX3Jlc3BvbnNlX2JvZHkgPSBuaWwKICAgIHJldHVybiBidWZmZXJlZAogIGVuZAoKICBhcmdbMV0gPSBuaWwKICByZXR1cm4gbmlsCmVuZAoKbG9jYWwgZnVuY3Rpb24gbWltZV90eXBlKGNvbnRlbnRfdHlwZSkKICAgIHJldHVybiBNaW1lLm5ldyhjb250ZW50X3R5cGUpLm1lZGlhX3R5cGUKZW5kCgpmdW5jdGlvbiBfTS5pc1NTRVN0cmVhbWluZ1Jlc3BvbnNlKGNvbnRlbnRfdHlwZSkKICByZXR1cm4gc3NlX2NvbnRlbnRfdHlwZXNbbWltZV90eXBlKGNvbnRlbnRfdHlwZSldCmVuZAoKCmZ1bmN0aW9uIF9NLmRlY29kZV9qc29uKHJlc3BvbnNlKQogICAgaWYganNvbl9jb250ZW50X3R5cGVzW21pbWVfdHlwZShyZXNwb25zZS5oZWFkZXJzLmNvbnRlbnRfdHlwZSldIHRoZW4KICAgICAgICByZXR1cm4gY2pzb24uZGVjb2RlKHJlc3BvbnNlLmJvZHkpCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIG5pbCwgJ25vdCBqc29uJwogICAgZW5kCmVuZAoKZnVuY3Rpb24gX00uZ2V0X2pzb25fYm9keShjaHVuaywgZmluaXNoZWQpCiAgbG9jYWwgcmVzcG9uc2VfYm9keSA9IF9NLmdldF9yYXdfYm9keShjaHVuaywgZmluaXNoZWQpCiAgaWYgcmVzcG9uc2VfYm9keSB0aGVuCiAgICBsb2NhbCBlcnIKICAgIGlmIHR5cGUocmVzcG9uc2VfYm9keSkgPT0gInN0cmluZyIgdGhlbgogICAgICByZXNwb25zZV9ib2R5LCBlcnIgPSBjanNvbi5kZWNvZGUocmVzcG9uc2VfYm9keSkKICAgICAgaWYgZXJyIHRoZW4KICAgICAgICByZXR1cm4gbmlsLCBlcnIKICAgICAgZW5kCiAgICAgIHJldHVybiByZXNwb25zZV9ib2R5CiAgICBlbHNlCiAgICAgIHJldHVybiBuaWwsICJ1bmtub3duIHJlc3BvbnNlIGJvZHkgdHlwZSIKICAgIGVuZAogIGVuZAoKICByZXR1cm4gbmlsCmVuZAoKbG9jYWwgZnVuY3Rpb24gcHJvY2Vzc19maWVsZChldmVudCwgZmllbGQsIHZhbHVlKQogIGlmIGZpZWxkID09ICJldmVudCIgdGhlbiBldmVudC5ldmVudCA9IHZhbHVlCiAgZWxzZWlmIGZpZWxkID09ICJkYXRhIiB0aGVuIGV2ZW50LmRhdGEgPSB2YWx1ZQogIGVsc2VpZiBmaWVsZCA9PSAiaWQiIHRoZW4KICAgIC0tIGVtcHR5IElEcyBhcmUgdmFsaWQsIG9ubHkgSURzIHRoYXQgY29udGFpbiB0aGUgbnVsbCBieXRlIG11c3QgYmUgaWdub3JlZDoKICAgIGxvY2FsIG51bGxfdGVybWluYXRvciwgXyA9IHN0cl9maW5kKHZhbHVlLCAiXDAiKQogICAgaWYgbm90IG51bGxfdGVybWluYXRvciB0aGVuCiAgICAgIGV2ZW50LmlkID12YWx1ZQogICAgZW5kCiAgZWxzZWlmIGZpZWxkID09ICJyZXRyeSIgdGhlbgogICAgLS0gd29uJ3QgaGFuZGxlIHRoaXMgZmllbGQsIHdlIG9ubHkgd2FudCB0byBleHRyYWN0IHRoZSB0b2tlbgogIGVsc2UKICAgIC0tIGlnbm9yZQogICAgcmV0dXJuCiAgZW5kCmVuZAoKLS0gUGFyc2VzIGFuIFNTRSBzdHJlYW0gYW5kIHlpZWxkcyBhbGwgaW5jb21pbmcgZXZlbnRzLAotLQotLSBUaGUgInJldHJ5IiBmaWVsZCBpcyBpZ25vcmUuCi0tCi0tIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL3NlcnZlci1zZW50LWV2ZW50cy5odG1sI2V2ZW50LXN0cmVhbS1pbnRlcnByZXRhdGlvbgpsb2NhbCBmdW5jdGlvbiBwYXJzZV9zc2VfZXZlbnRzKGNodW5rKQogIGxvY2FsIGV2ZW50cyA9IHt9CiAgbG9jYWwgYnVmZmVyZWQgPSBuZ3guY3R4LnNzZV90cnVuY2F0ZWRfZXZlbnQKCiAgaWYgKG5vdCBjaHVuaykgb3IgKCNjaHVuayA8IDEpIG9yICh0eXBlKGNodW5rKSkgfj0gInN0cmluZyIgdGhlbgogICAgcmV0dXJuCiAgZW5kCgogIC0tIEEgc2luZ2xlIGNodW5rIGNhbiBjb250YWlucyBtdWx0aXBsZSBsaW5lcwogIGxvY2FsIGV2ZW50X2xpbmVzID0gc3BsaXQoY2h1bmssICJcbiIpCgogIC0tIFdoZW4gYSBzdHJlYW0gaXMgcGFyc2VkLCBhIGRhdGEgYnVmZmVyLCBhbiBldmVudCB0eXBlIGJ1ZmZlciwgYW5kIGEgbGFzdAogIC0tIGV2ZW50IElEIGJ1ZmZlciBtdXN0IGJlIGFzc29jaWF0ZWQgd2l0aCBpdC4gVGhleSBtdXN0IGJlIGluaXRpYWxpemVkIHRvCiAgLS0gdGhlIGVtcHR5IHN0cmluZy4KICBsb2NhbCBldmVudCA9IHtldmVudCA9ICIiLCBpZCA9ICIiLCBkYXRhID0gIiJ9CgogIC0tIFJlYWQgbGluZSBieSBsaW5lCiAgZm9yIGksIGxpbmUgaW4gaXBhaXJzKGV2ZW50X2xpbmVzKSBkbwogICAgaWYgI2xpbmUgPCAxIHRoZW4KICAgICAgIGV2ZW50c1sjZXZlbnRzICsgMV0gPSBldmVudAogICAgICAgZXZlbnQgPSB7IGV2ZW50ID0gIiIsIGlkID0gIiIsIGRhdGEgPSAiIiB9CiAgICBlbmQKCiAgICAtLSBjaGVjayBpZiB0aGlzIGlzIGEgdHJ1bmNhdGVkIGxpbmUKICAgIGlmICNsaW5lID4gMCBhbmQgI2V2ZW50X2xpbmVzID09IGkgdGhlbgogICAgICBpZiBub3QgYnVmZmVyZWQgdGhlbgogICAgICAgIGJ1ZmZlcmVkID0ge30gLS0gWFhYIHdlIGNhbiB1c2UgdGFibGUubmV3IGhlcmUKICAgICAgICBuZ3guY3R4LnNzZV90cnVuY2F0ZWRfZXZlbnQgPSBidWZmZXJlZAogICAgICBlbmQKCiAgICAgIGJ1ZmZlcmVkWyNidWZmZXJlZCsxXSA9IGxpbmUKICAgICAgYnJlYWsKICAgIGVuZAoKICAgIC0tIGNvbnRpbnVlIGZyb20gdGhlIHByZXZpb3VzIHRydW5jYXRlZCBjaHVuawogICAgaWYgYnVmZmVyZWQgdGhlbgogICAgICBidWZmZXJlZFsjYnVmZmVyZWQrMV0gPSBsaW5lCiAgICAgIGxpbmUgPSBjb25jYXQoYnVmZmVyZWQpCiAgICAgIG5neC5jdHguc3NlX3RydW5jYXRlZF9ldmVudCA9IG5pbAogICAgZW5kCgogICAgLS0gZmluZCB3aGVyZSB0aGUgZmlyc3QgY29sb24gcG9zaXRpb24gaXMKICAgIGxvY2FsIGNvbG9uX3BvcywgXyA9IHN0cl9maW5kKGxpbmUsICI6IikKCiAgICAtLSBJZ25vcmUgbGluZSBzdGFydCB3aXRoICg6KSBjaGFyYWN0ZXIKICAgIGlmIGNvbG9uX3BvcyA9PSAxIHRoZW4KICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICAtLSBJZiB0aGUgbGluZSBjb250YWlucyBDT0xPTiAoOikgY2hhcmFjdGVyCiAgICBpZiBjb2xvbl9wb3MgdGhlbgogICAgICAgLS0gQ29sbGVjdCB0aGUgY2hhcmFjdGVycyBvbiB0aGUgbGluZSBiZWZvcmUgYW5kIGFmdGVyIHRoZSB0aGUgZmlyc3QgVSswMDNBIENPTE9OIGNoYXJhY3RlciAoOikuCiAgICAgIGxvY2FsIGZpZWxkID0gc3RyX3N1YihsaW5lLCAxLCBjb2xvbl9wb3MtMSkgLS0gcmV0dXJucyAiZGF0YSIgZnJvbSBkYXRhOiBoZWxsbyB3b3JsZAogICAgICBsb2NhbCB2YWx1ZSA9IHN0cl9zdWIobGluZSwgY29sb25fcG9zKzEpIC0tIHJldHVybnMgImhlbGxvIHdvcmxkIiBmcm9tIGRhdGE6IGhlbGxvIHdvcmxkCgogICAgICAtLSBSZW1vdmUgbGVhZGluZyB3aGl0ZSBzcGFjZSBjaGFyYWN0ZXIgZnJvbSB2YWx1ZQogICAgICB2YWx1ZSA9IHZhbHVlOmdzdWIoIl4lcyoiLCAiIikKCiAgICAgIHByb2Nlc3NfZmllbGQoZXZlbnQsIGZpZWxkLCB2YWx1ZSkKICAgIGVsc2UKICAgICAgLS0gdGhlIHN0cmluZyBpcyBub3QgZW1wdHkgYnV0IGRvZXMgbm90IGNvbnRhaW4gYSBDT0xPTiBjaGFyYWN0ZXIgKDopCiAgICAgIHByb2Nlc3NfZmllbGQoZXZlbnQsIGxpbmUsICIiKQogICAgZW5kCiAgZW5kCgogIHJldHVybiBldmVudHMKZW5kCgpmdW5jdGlvbiBfTS5nZXRfc3NlX2V2ZW50cyhjaHVuaykKICByZXR1cm4gcGFyc2Vfc3NlX2V2ZW50cyhjaHVuaykKZW5kCgpyZXR1cm4gX00K
{{- end }}
